(window.webpackJsonp=window.webpackJsonp||[]).push([[33,8],{447:function(t,e,r){var content=r(461);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(21).default)("32148acd",content,!0,{sourceMap:!1})},457:function(t,e,r){"use strict";r.r(e);r(9),r(61),r(25),r(38),r(73),r(55),r(8),r(68),r(82),r(56);function n(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var c,d=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return d=t.done,t},e:function(t){l=!0,c=t},f:function(){try{d||null==r.return||r.return()}finally{if(l)throw c}}}}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}var c={props:{destLists:Array},computed:{path:function(){var path=[];return this.dests.forEach((function(t){path.push(t.position)})),path},dests:function(){return this.destLists}},data:function(){return{maplocation:{lat:40,lng:140},zoom:4,styleMap:{width:"100%",height:"500px"},mapOptions:{streetViewControl:!1,styles:[]},windowSize:{h:0,w:0}}},mounted:function(){0!=this.dests.length&&this.setMaplocation()},methods:{setMaplocation:function(){var t=0,e=0;this.dests.forEach((function(r){t+=r.position.lat,e+=r.position.lng}));var r={lat:t/this.dests.length,lng:e/this.dests.length};this.maplocation=r,this.setZoom()},setZoom:function(){var t=this;this.$gmapApiPromiseLazy().then((function(){if(t.dests.length>=2){var e,r=new google.maps.LatLngBounds,o=n(t.dests);try{for(o.s();!(e=o.n()).done;){var c=e.value;r.extend(c.position)}}catch(t){o.e(t)}finally{o.f()}t.$refs.gmap.fitBounds(r)}}))},resizeWindow:function(){if(window.innerWidth<600){var t=String(Math.floor((window.innerHeight-56)/3));this.styleMap.height=t+"px"}else this.styleMap.height="500px"}}},d=r(30),l=r(90),h=r.n(l),f=r(441),v=r(432),m=r(433),w=r(440),k=r.n(w),_=r(210),component=Object(d.a)(c,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-row",{directives:[{name:"resize",rawName:"v-resize",value:t.resizeWindow,expression:"resizeWindow"}]},[r("v-col",[r("v-card",{attrs:{flat:""}},[r("GmapMap",{ref:"gmap",style:t.styleMap,attrs:{"map-type-id":"roadmap",center:t.maplocation,zoom:t.zoom,options:t.mapOptions}},[t._l(t.dests,(function(e){return r("GmapInfoWindow",{key:"first-"+e.order,attrs:{opened:e.window_open,position:e.position,options:{pixelOffset:{width:0,height:-35}}},on:{closeclick:function(t){e.window_open=!1}}},[t._v(t._s(e.order)+"."+t._s(e.name))])})),t._v(" "),t._l(t.dests,(function(e,n){return r("GmapMarker",{key:"second-"+e.order,attrs:{title:e.name,position:e.position},on:{click:function(e){return t.$emit("clickMarker",n)}}})})),t._v(" "),r("GmapPolyline",{attrs:{path:t.path,options:{strokeColor:"#1A73E8"}}})],2)],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports;h()(component,{VCard:f.a,VCol:v.a,VRow:m.a}),k()(component,{Resize:_.a})},460:function(t,e,r){"use strict";r(447)},461:function(t,e,r){var n=r(20)(!1);n.push([t.i,".v-list.v-sheet.theme--light[data-v-731f7a9d]{padding:0}.isButton.scroll.v-card.v-sheet.theme--light[data-v-731f7a9d]{margin-top:10px}",""]),t.exports=n},464:function(t,e,r){"use strict";r.r(e);var n=r(24),o=(r(66),r(9),r(39),r(128),r(29),r(98),{props:{authorId:String,bookId:String,pageName:String},data:function(){return{dests:[],isEdit:!1,book:null,bookData:{},dates:[],selectDate:0,userId:this.authorId,mapActive:!1,mapHeight:500,destHeight:450,isIconShow:!1,isShowAddress:!0,listHeight:400}},watch:{selectDate:function(){this.getDests}},computed:{firstDate:function(){if(!this.$route.query.date)return 0;returnthis.$route.query.date}},mounted:function(){this.authorId||(this.userId=this.$store.getters.userId),this.book=this.$fb.firestore().collection("users").doc(this.userId).collection("books").doc(this.bookId),this.getBookData()},methods:{getBookData:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.book.get();case 2:(r=e.sent).exists&&(t.bookData=r.data(),t.getDates(),t.getDests());case 4:case"end":return e.stop()}}),e)})))()},getDests:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.mapActive=!1,r=t.selectDate+1,e.next=4,t.book.collection("dests").where("date","==",r).orderBy("order").get().then((function(e){e?(t.dests=e.docs.map((function(t){return t.data()})),t.dests.forEach((function(e){t.$set(e,"window_open",!1)})),t.mapActive=!0):(t.dests=[],t.mapActive=!0)}));case 4:case"end":return e.stop()}}),e)})))()},openInfo:function(i){this.dests.forEach((function(t){return t.window_open=!1})),this.dests[i].window_open=!0},toSearch:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.$fb.firestore.FieldValue.serverTimestamp(),t.book.update({update:r}),t.$router.push("/mypage/".concat(t.bookId,"/search?date=").concat(t.selectDate,"&order=").concat(t.dests.length));case 3:case"end":return e.stop()}}),e)})))()},toEditBook:function(){this.$router.push("/mypage/".concat(this.bookId,"/edit"))},editBtn:function(){this.isEdit=!0},editDone:function(){var t=this;this.dests.forEach((function(e,i){var r=++i;e.order!==r&&t.setOrder(r,e.id,i)})),this.isEdit=!1},setOrder:function(t,e){var r=this;return Object(n.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.book.collection("dests").doc(e).update({order:t});case 2:case"end":return n.stop()}}),n)})))()},deleteBtn:function(t,i){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.book.collection("dests").doc(t).delete();case 2:e.dests.splice(i,1);case 3:case"end":return r.stop()}}),r)})))()},setDate:function(t){return{year:Number(t.substr(0,4)),month:Number(t.substr(5,2)),date:Number(t.substr(8,2))}},getDates:function(){for(var t=this.setDate(this.bookData.firstDate),e=this.setDate(this.bookData.lastDate),r=new Date(t.year,t.month-1,t.date),n=(new Date(e.year,e.month-1,e.date)-r)/864e5,i=1;i<=n+1;i++)this.dates.push(i)},editDestsBtn:function(t){this.authorId?this.$router.push("/".concat(this.pageName,"/").concat(this.authorId,"/").concat(this.bookId,"/").concat(t,"?date=").concat(this.selectDate)):this.$router.push("/mypage/".concat(this.bookId,"/").concat(t,"?date=").concat(this.selectDate))},resizeWindow:function(){if(window.innerWidth<600){this.mapHeight=Math.floor((window.innerHeight-56)/3),this.destHeight=2*this.mapHeight-50-50-50}else this.destHeight=450;window.innerWidth<400?(this.isIconShow=!1,this.isShowAddress=!1):(this.isIconShow=!0,this.isShowAddress=!0),this.authorId?this.listHeight=this.destHeight-10:this.listHeight=this.destHeight-60}}}),c=(r(460),r(30)),d=r(90),l=r.n(d),h=r(236),f=r(441),v=r(473),m=r(573),w=r(432),k=r(198),_=r(199),y=r(124),x=r(200),I=r(110),D=r(433),E=r(78),S=r(440),A=r.n(S),C=r(210),component=Object(c.a)(o,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-row",{directives:[{name:"resize",rawName:"v-resize",value:t.resizeWindow,expression:"resizeWindow"}],staticClass:"page-wrap",attrs:{justify:"center",align:"center"}},[r("v-col",{attrs:{cols:"11",md:"10"}},[r("v-row",{staticClass:"align-center"},[r("h3",{staticClass:"d-inline-block"},[t._v(t._s(t.bookData.title))]),t._v(" "),t.authorId?t._e():r("v-icon",{staticClass:"ml-4 on-click",on:{click:t.toEditBook}},[t._v("mdi-pencil")])],1),t._v(" "),r("v-row",{attrs:{justify:"space-between"}},[r("v-col",{staticClass:"pr-4",attrs:{cols:"12",sm:"6"}},[t.mapActive?t._e():r("div",{style:{height:t.mapHeight+"px"}}),t._v(" "),t.mapActive?r("MapParts",{attrs:{destLists:t.dests},on:{clickMarker:t.openInfo}}):t._e()],1),t._v(" "),r("v-col",{staticClass:"pl-4",attrs:{cols:"12",sm:"6"}},[r("v-sheet",[r("v-chip-group",{attrs:{mandatory:"","active-class":"primary--text","next-icon":"mdi-chevron-right","show-arrows":t.isIconShow},on:{change:t.getDests},model:{value:t.selectDate,callback:function(e){t.selectDate=e},expression:"selectDate"}},t._l(t.dates,(function(e){return r("v-chip",{key:e},[t._v(t._s(e)+"日目")])})),1)],1),t._v(" "),r("v-card",{style:{height:t.destHeight+"px"},attrs:{outlined:""}},[t.authorId?t._e():r("v-row",{staticClass:"mt-3 mr-4",attrs:{justify:"end"}},[r("v-btn",{attrs:{text:"",color:"primary",disabled:t.isEdit},on:{click:t.toSearch}},[t._v("目的地追加")]),t._v(" "),r("v-btn",{directives:[{name:"show",rawName:"v-show",value:!t.isEdit,expression:"!isEdit"}],attrs:{text:"",color:"error"},on:{click:t.editBtn}},[t._v("編集")]),t._v(" "),r("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.isEdit,expression:"isEdit"}],attrs:{text:"",color:"error"},on:{click:t.editDone}},[t._v("完了")])],1),t._v(" "),r("v-row",{attrs:{"no-gutters":""}},[r("v-col",[r("v-card",{class:["scroll",{isButton:!t.authorId}],style:{height:t.listHeight+"px"},attrs:{flat:""}},[r("v-list",[r("v-list-item-group",[r("draggable",{attrs:{handle:".item-handle"},model:{value:t.dests,callback:function(e){t.dests=e},expression:"dests"}},t._l(t.dests,(function(e,i){return r("v-list-item",{key:e.order,on:{click:function(e){return t.openInfo(i)}}},[r("v-icon",{directives:[{name:"show",rawName:"v-show",value:t.isEdit,expression:"isEdit"}],staticClass:"item-handle",attrs:{color:"#c0c0c0"}},[t._v("mdi-drag-horizontal-variant")]),t._v(" "),r("v-list-item-title",{staticClass:"mr-4"},[r("span",{directives:[{name:"show",rawName:"v-show",value:!t.isEdit,expression:"!isEdit"}]},[t._v(t._s(i+1)+".")]),t._v("\n                          "+t._s(e.name))]),t._v(" "),r("v-list-item-subtitle",{directives:[{name:"show",rawName:"v-show",value:t.isShowAddress,expression:"isShowAddress"}],staticClass:"address"},[t._v(t._s(e.address))]),t._v(" "),r("v-btn",{attrs:{color:"primary",text:""},on:{click:function(r){return t.editDestsBtn(e.id)}}},[t._v("詳細")]),t._v(" "),r("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.isEdit,expression:"isEdit"}],attrs:{color:"error",text:""},on:{click:function(r){return t.deleteBtn(e.id,i)}}},[t._v("削除")])],1)})),1)],1)],1)],1)],1)],1)],1)],1)],1)],1)],1)}),[],!1,null,"731f7a9d",null);e.default=component.exports;l()(component,{MapParts:r(457).default}),l()(component,{VBtn:h.a,VCard:f.a,VChip:v.a,VChipGroup:m.a,VCol:w.a,VIcon:k.a,VList:_.a,VListItem:y.a,VListItemGroup:x.a,VListItemSubtitle:I.b,VListItemTitle:I.c,VRow:D.a,VSheet:E.a}),A()(component,{Resize:C.a})},567:function(t,e,r){"use strict";r.r(e);var n={},o=r(30),component=Object(o.a)(n,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("BooksPage",{attrs:{authorId:t.$route.params.authorId,bookId:t.$route.params.bookId,pageName:"timeline"}})}),[],!1,null,null,null);e.default=component.exports;installComponents(component,{BooksPage:r(464).default})}}]);